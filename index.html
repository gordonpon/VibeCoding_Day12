<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¹´é½¡è¨ˆç®—å™¨</title>
</head>
<body>
  <h1>ğŸ‚ å¹´é½¡è¨ˆç®—å™¨ï¼ˆlocalStorage ç¯„ä¾‹ï¼‰</h1>

  <p>è«‹é¸æ“‡é¡å‹å’Œç”Ÿæ—¥ï¼ŒæŒ‰ä¸‹ã€Œè¨ˆç®—ã€ä¾†è¨ˆç®—å¹´é½¡ï¼š</p>

  <div style="margin-bottom: 10px;">
    <label>
      <input type="radio" name="ageType" value="human" checked>
      äºº
    </label>
    <label style="margin-left: 20px;">
      <input type="radio" name="ageType" value="dog">
      å°ç‹—
    </label>
  </div>

  <input id="note-input" type="date" style="width: 280px;">
  <button id="save-btn">è¨ˆç®—</button>

  <p id="display">ç›®å‰é‚„æ²’æœ‰å„²å­˜ä»»ä½•æ—¥æœŸã€‚</p>

  <script>
    const KEY_DATE = 'birthdate';
    const KEY_TYPE = 'ageType';
    const input = document.getElementById('note-input');
    const saveBtn = document.getElementById('save-btn');
    const display = document.getElementById('display');
    const radioButtons = document.querySelectorAll('input[name="ageType"]');

    // è¨ˆç®—å¹´é½¡çš„å‡½æ•¸
    function calculateAge(birthDate, type) {
      const today = new Date();
      const birth = new Date(birthDate);
      let age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();
      
      // å¦‚æœä»Šå¹´ç”Ÿæ—¥é‚„æ²’åˆ°ï¼Œå¹´é½¡æ¸› 1
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      
      // å¦‚æœæ˜¯å°ç‹—ï¼Œä¹˜ä»¥ 7
      if (type === 'dog') {
        age = age * 7;
      }
      
      return age;
    }

    // ç¬¬ä¸€æ¬¡é€²ä¾†é é¢æ™‚ï¼Œå…ˆè©¦è‘—æŠŠèˆŠè³‡æ–™æ‹¿å‡ºä¾†
    const savedDate = localStorage.getItem(KEY_DATE);
    const savedType = localStorage.getItem(KEY_TYPE) || 'human';
    
    if (savedDate) {
      input.value = savedDate;
      // è¨­å®š radio button
      radioButtons.forEach(radio => {
        if (radio.value === savedType) {
          radio.checked = true;
        }
      });
      
      const age = calculateAge(savedDate, savedType);
      const typeName = savedType === 'human' ? 'äºº' : 'å°ç‹—';
      display.textContent = `${typeName}çš„ç”Ÿæ—¥ï¼š${savedDate}ï¼Œä»Šå¹´å¹´é½¡ï¼š${age} æ­²`;
    }

    // æŒ‰ä¸‹è¨ˆç®—ï¼Œå°±æŠŠæ—¥æœŸå’Œé¡å‹å­˜é€² localStorage ä¸¦è¨ˆç®—å¹´é½¡
    saveBtn.addEventListener('click', function () {
      const birthDate = input.value;
      const selectedType = document.querySelector('input[name="ageType"]:checked').value;
      
      if (birthDate) {
        localStorage.setItem(KEY_DATE, birthDate);
        localStorage.setItem(KEY_TYPE, selectedType);
        
        const age = calculateAge(birthDate, selectedType);
        const typeName = selectedType === 'human' ? 'äºº' : 'å°ç‹—';
        display.textContent = `${typeName}çš„ç”Ÿæ—¥ï¼š${birthDate}ï¼Œä»Šå¹´å¹´é½¡ï¼š${age} æ­²`;
      } else {
        display.textContent = 'è«‹å…ˆé¸æ“‡æ—¥æœŸï¼';
      }
    });
  </script>
</body>
</html>
