<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¹´é½¡è¨ˆç®—å™¨</title>
</head>
<body>
  <h1>ğŸ‚ å¹´é½¡è¨ˆç®—å™¨ï¼ˆlocalStorage ç¯„ä¾‹ï¼‰</h1>

  <p>è«‹é¸æ“‡æ‚¨çš„ç”Ÿæ—¥ï¼ŒæŒ‰ä¸‹ã€Œå„²å­˜ã€è¨ˆç®—ä»Šå¹´çš„å¹´é½¡ï¼š</p>

  <input id="note-input" type="date" style="width: 280px;">
  <button id="save-btn">è¨ˆç®—</button>

  <p id="display">ç›®å‰é‚„æ²’æœ‰å„²å­˜ä»»ä½•æ—¥æœŸã€‚</p>

  <script>
    const KEY = 'birthdate';
    const input = document.getElementById('note-input');
    const saveBtn = document.getElementById('save-btn');
    const display = document.getElementById('display');

    // è¨ˆç®—å¹´é½¡çš„å‡½æ•¸
    function calculateAge(birthDate) {
      const today = new Date();
      const birth = new Date(birthDate);
      let age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();
      
      // å¦‚æœä»Šå¹´ç”Ÿæ—¥é‚„æ²’åˆ°ï¼Œå¹´é½¡æ¸› 1
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      
      return age;
    }

    // ç¬¬ä¸€æ¬¡é€²ä¾†é é¢æ™‚ï¼Œå…ˆè©¦è‘—æŠŠèˆŠè³‡æ–™æ‹¿å‡ºä¾†
    const saved = localStorage.getItem(KEY);
    if (saved) {
      input.value = saved;
      const age = calculateAge(saved);
      display.textContent = `æ‚¨çš„ç”Ÿæ—¥ï¼š${saved}ï¼Œä»Šå¹´å¹´é½¡ï¼š${age} æ­²`;
    }

    // æŒ‰ä¸‹å„²å­˜ï¼Œå°±æŠŠæ—¥æœŸå­˜é€² localStorage ä¸¦è¨ˆç®—å¹´é½¡
    saveBtn.addEventListener('click', function () {
      const birthDate = input.value;
      if (birthDate) {
        localStorage.setItem(KEY, birthDate);
        const age = calculateAge(birthDate);
        display.textContent = `æ‚¨çš„ç”Ÿæ—¥ï¼š${birthDate}ï¼Œä»Šå¹´å¹´é½¡ï¼š${age} æ­²`;
      } else {
        display.textContent = 'è«‹å…ˆé¸æ“‡æ—¥æœŸï¼';
      }
    });
  </script>
</body>
</html>
